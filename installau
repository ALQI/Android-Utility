#! /bin/bash

clear

# Installation Script


# Functions

# .bash_profile
bpro ()
{	b=.bash_profile
	clear
	echo "Checking status of .bash_profile..."
	if [[ -s $HOME/$b ]] ; then
		echo
		echo "$b exists, would you like to: [default=3]"
		echo 
		echo "  1. Overwrite"
		echo "  2. Append to $b"
		echo "  3. Do not create new $b"
		read -s -n 1 ans
		case $ans in 
		1) bpro1;;
		2) bpro2;;
		*) echo; echo "$b remained unchanged"; enter;;
		esac
	else
		bpro3
	fi	
}

bpro1 ()
{	b=.bash_profile
	cp $HOME/$b $HOME/$b.bak
	echo
	echo "Removing $b"
	sudo rm $HOME/$b
	echo
	echo "Creating new $b"
	touch $HOME/$b
	( echo; echo "export PATH=\${PATH}:\$HOME/bin:\$HOME/android-utility:\$HOME/android-utility/utility:\$HOME/android-sdk/platform-tools/:\$HOME/android-sdk/tools" ) >>$b
	source $HOME/$b
	enter
}

bpro2 ()
{	b=.bash_profile
	cp $HOME/$b $HOME/$b.bak
	echo
	echo "Appending Information to $b"
	( echo; echo "export PATH=\${PATH}:\$HOME/bin:\$HOME/android-utility:\$HOME/android-utility/utility:\$HOME/android-sdk/platform-tools/:\$HOME/android-sdk/tools" ) >>$b
	source $HOME/$b
	enter
}

bpro3 ()
{	echo
	echo "$b does not exist. Preparing to create $b"
	echo "export PATH=\${PATH}:\$HOME/bin:\$HOME/android-utility:\$HOME/android-utility/utility:\$HOME/android-sdk/platform-tools/:\$HOME/android-sdk/tools" >>$b
	source $HOME/$b
	enter
}

#enterKey
enterKey()
{	echo "### Press [enter] to continue, any other key to quit";
	read -s -n 1 key
	if [[ $key = "" ]]; then 
  		echo 
	else
  		echo
  		echo "Installation aborted";
		enter
		inst
	fi
}

#enter
enter()
{	echo
	echo "Please press [enter] to continue";
	read -s -n 1 key
	if [[ $key = "" ]]; then 
  		echo
  		clear
	fi
}

#export PATH
export_PATH ()
{	cd $HOME/android-utility/
	echo "Your PATH:"
	echo
	echo "$PATH"
	echo
}

#make directories
makedir ()
{	w=$HOME/android-utility/working-folder
	echo "Checking status of $w..."
	if [[ -s $w ]] ; then	
		echo
		echo "Working folder exists, would you like to start over? [default=Y]"
		echo
		echo "  1. Yes"
		echo "  2. No"
		read -s -n 1 ans
		case $ans in 
		1) echo; rm -r $w; echo "Working folder replaced "; makedirB;;
		2) echo; echo "Working folder remained unchanged"; enter;;
		*) echo; rm -r $w; echo "Working folder replaced "; makedirB;;
		esac
	else
		makedirB
	fi
}

makedirBIN ()
{	w=$HOME/bin
	echo "Checking status of $w..."
	if [[ -s $w ]] ; then
		echo
		echo "$w exists, would you like to overwrite? [default=Y]"
		echo
		echo "  1. Yes"
		echo "  2. No"
		read -s -n 1 ans
		case $ans in 
		1) echo; rm -r $w; makedirC; echo "$w replaced "; enter;;
		2) echo; echo "/bin remained unchanged"; enter;;
		*) echo; rm -r $w; makedirC; echo "$w replaced "; enter;;
		esac
	else
		makedirC
		enter
	fi	
}


makedirB ()
{	mkdir $HOME/android-utility/working-folder
	mkdir $w/apk-here-solo
	mkdir $w/apks-here-multi
	mkdir $w/framework-here
	mkdir $w/ninepatch
	enter
	}

makedirC ()
{	y=$HOME/bin
	echo "Creating New bin Directory"
	mkdir $y
	echo 
}

#quit
quit()
{	echo
	echo "Thank you for choosing Android Utility"
	echo "brought to you by tommytomatoe :-)"
	echo
	echo "Please Don't Drink and Drive"
	echo
	exit
}

#select
selection ()
{	echo
	echo "You've selcted [$COM]"
	echo
}

## INSTALLS

first_time ()
{	COM="First Time Install"
	selection
	enterKey
	bpro
	makedir
	makedirBIN
	export_PATH
	sleep .75
	echo "Adding executable permission to resources"
	chmod 755 resources/clean/*
	echo
	echo "Adding resources to $HOME/bin"
	echo
	cp resources/clean/aapt-9 $HOME/bin/aapt
	cp resources/clean/adb $HOME/bin/adb
   	cp resources/clean/andutil $HOME/bin/
	cp resources/clean/apktool $HOME/bin/
	cp resources/clean/apktool-1.4.1.jar $HOME/bin/apktool.jar
	cp resources/clean/baksmali $HOME/bin/
	cp resources/clean/baksmali.jar $HOME/bin/
	cp resources/clean/decode9patchPng.jar $HOME/bin/
	cp resources/clean/smali $HOME/bin/
	cp resources/clean/smali.jar $HOME/bin/
	echo
	sleep .75
	echo "Fixing permissions"
	echo
	sudo chmod 755 $HOME/bin/*
	echo "All Done. Now, enjoy android-utility"
	enter
}

ins_apktool ()
{	COM="Install new apktool"
	selection
	enterKey
	clear
	echo "Your current verion of apktool is listed as:"
	echo
	echo "### `apktool | sed -n 1p`"
	echo
	echo "Which version of apktool would you like to install?"
	echo
	echo "  1.  apktool 1.3.1"
	echo "  2.  apktool 1.3.2"
	echo "  3.  apktool 1.4.1"
	echo
	printf "Please make your selection: "
	read sel
	case $sel in
	 1) sudo cp $HOME/android-utility/resources/apktool1.3.1/apktool.jar $HOME/bin/;;
	 2) sudo cp $HOME/android-utility/resources/apktool1.3.2/apktool.jar $HOME/bin/;;
	 3) sudo cp $HOME/android-utility/resources/apktool1.4.1/apktool.jar $HOME/bin/;;
	 *) echo; echo "$sel is not a valid option"; echo;;	
	esac
	echo
	echo "Your version of apktool is now:"
	echo
	echo "### `apktool | sed -n 1p`"
	enter
	}
	
ins_aapt ()
{	COM="Install new aapt"
	selection
	enterKey
	clear
	echo "Which version of aapt would you like to install?"
	echo
	echo "  1.  aapt sdk  8 - Froyo Development"
	echo "  2.  aapt sdk  9 - Gingerbread Development"
	echo "  3.  aapt sdk 10 - Honeycomb Development"
	echo
	printf "Please make your selection: "
	read sel
	case $sel in
	 1) sudo cp $HOME/android-utility/resources/aapt/aapt-8 $HOME/bin/aapt;;
	 2) sudo cp $HOME/android-utility/resources/aapt/aapt-9 $HOME/bin/aapt;;
	 3) sudo cp $HOME/android-utility/resources/aapt/aapt-10 $HOME/bin/aapt;;
	 *) echo; echo "$sel is not a valid option"; echo;;	
	esac
	echo
	echo "Your version of aapt has been updated"
	enter
	}
	
ins_addon ()
{	COM="Install new add-ons"
	selection
	enterKey
	clear
	echo "Option coming in a future release. Stay tuned."
	enter
	}
	

inst () 
{
echo "     -----------------------     "
echo "|     Android Utility v0.0.1    |"
echo "|      Installaltion Guide      |"
echo "|-------------------------------|"
echo "|-------------------------------|"
echo "| 1.  First Time Install        |"
echo "|-------------------------------|"
echo "| 2.  Install new apktool       |"
echo "| 3.  Install new aapt          |"
echo "| 4.  Install new add-ons       |"
echo "| 5.  Install Working Folder    |"
echo "|-------------------------------|"
echo "| x.  Run Android Utility       |"
echo "|-------------------------------|"
echo "|-------------------------------|"
echo "| q.  Quit Installation Guide   |"
echo "     -----------------------     "
printf %s "  Please Select Install: "
read num
case $num in
 1) first_time;;
 2) ins_apktool;;
 3) ins_aapt;;
 4) ins_addon;;
 5) clear; makedir;;
 x) andutil;;
 b) bpro;;
 q) quit;;
 *) echo; echo "$num is not a valid option"; enter;
esac
}

while :
do
	inst
done